#!/bin/bash

## Pushes a Docker image to Artifactory, using Notary
## trust-pinning to guarantee that any subsequent
## pull using docker-pull-artifactory or 
## docker-pull-artifactory-cronjob is guaranteed to
## be of the same image.

## Command-line arguments:
##    $1 a way of referring to the local image to be pushed
##    $2 the remote Docker registry repo, including the host
##    $3 the remote tag

## Environment variables:
## NOTARY_URL must be set to the URL of the Notary server
## NOTARY_CLIENT must be set to the path of the Notary client

print_usage() {
    cat << EOF
Usage: docker-push-notary local_image remote_repo remote_tag

See the manpage for more information.
EOF
}

if test $# -ne 3 || test "$1" == "--help"; then
    print_usage
    exit 1
fi

source "$(cd $(dirname "$0")/../lib; pwd)/notary-util"
push "${@}"
